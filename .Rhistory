results_lists$ate_bias_results_test[[model_name]][[length(results_lists$ate_bias_results_test[[model_name]]) + 1]]  <- ate_bias_test
results_lists$ci_length_results_test[[model_name]][[length(results_lists$ci_length_results_test[[model_name]]) + 1]]  <- mean_ci_length_test
results_lists$coverage_results_test[[model_name]][[length(results_lists$coverage_results_test[[model_name]]) + 1]]  <- coverage_test
return(results_lists)
}
get_metrics <- function(ite_matrix, model_name, results_list, true_ate){#, true_ites) {
# Mean ITE for each observation
ite_estimates <- colMeans(ite_matrix)
ate_draws <- rowMeans(ite_matrix)
# ATE Bias
ate_estimate <- mean(ite_estimates)
ate_bias <- ate_estimate - true_ate
# PEHE
# pehe_test <- sqrt(mean((true_ites - ite_prediction)^2))
# Credibility interval
credible_interval <- quantile(ate_draws, probs = c(0.025, 0.975))
# Interval length
ci_length <- unname(credible_interval[2] - credible_interval[1])
# Coverage
is_covered <- ifelse(credible_interval[1] <= true_ate &
true_ate <= credible_interval[2], 1, 0) %>% unname()
# Save results
results_list$ate_estimate[[model_name]] <- c(results_list$ate_estimate[[model_name]], ate_estimate) #TODO: vlt lÃ¶schen
results_list$ate_bias[[model_name]] <- c(results_list$ate_bias[[model_name]], ate_bias)
results_list$ci_length[[model_name]] <- c(results_list$ci_length[[model_name]], ci_length)
results_list$coverage[[model_name]] <- c(results_list$coverage[[model_name]], is_covered)
return(results_list)
}
get_metrics_not_bart <- function(results_list, model_name, icate_estimates, ate_estimate, se_ate, ate_true){
# PEHE
# pehe <- sqrt(mean((icate_estimates - )^2))
# Bias
ate_bias <- ate_true - ate_estimate
# Confidence intervals
ci_lower <- ate_estimate - 1.96 * se_ate
ci_upper <- ate_estimate + 1.96 * se_ate
# CI length
ci_length <- ci_upper - ci_lower
# Coverage
is_covered <- ifelse(ci_lower <= ate_true && ate_true <= ci_upper, 1, 0)
# Save results
results_list$ate_bias[[model_name]] <- c(results_list$ate_bias[[model_name]], ate_bias)
results_list$ci_length[[model_name]] <- c(results_list$ci_length[[model_name]], ci_length)
results_list$coverage[[model_name]] <- c(results_list$coverage[[model_name]], is_covered)
return(results_list)
}
# Uni-Computer
PATH_DATASETS <- "W:/Masterarbeit/Daten/"
PATH_TRUE_ATES <- "W:/Masterarbeit/Daten/trueATE/lowDim_trueATE.csv"
PATH_OVERVIEW <- "W:/Masterarbeit/Daten/trueATE/dgp_overview.csv"
PATH_RESULTS <- "W:/Masterarbeit/Results/"
dgpis <- read.csv(PATH_OVERVIEW)
all_datasets <- read.csv(PATH_TRUE_ATES)
cont_dgpis <- dgpis %>% filter(binary == 0)
all_results <- list()
all_summaries <- list()
for(i in 1:1){
dgp_index <- cont_dgpis$DGPid[i]
true_ate <- cont_dgpis$trueATE[i]
results <- make_results_list()
datasets_dgp <- all_datasets %>% filter(DGPid == dgp_index)
#for (j in 1:nrow(datasets_dgp)){
for (j in 1:5){
file_name <- datasets_dgp[j, "filename"]
data <- read.csv(paste0("W:/Masterarbeit/Daten/", file_name, ".csv"))
y <- data$Y
z <- data$A
X <- data %>% select(starts_with("V"))
# Regression formulas
formula_rightside <- colnames(X) %>% paste0(collapse = " + ")
ps_formula <- as.formula(paste0("z ~ ", formula_rightside))
outcome_formula <- as.formula(paste0("y ~ z + ", formula_rightside))
#PS Score calculation (needed for weighting, bcf, MAYBE psBART, MAYBE Matching?)
fit_ps_scores <- glm(ps_formula, data = data, family = binomial)
ps_scores_prediction <- predict(fit_ps_scores, type = "response")
results <- estimate_causal_forest(y, z, X, results, true_ate)
}
all_results[[paste0("dgp", dgp_index)]] <- results
all_summaries[[paste0("dgp", dgp_index)]] <- create_results_table(results)
}
?causal_forest
X_mm <- model.matrix(~ . - 1, data = X)
fit_causal_forest <- causal_forest(X_mm, y, z, tune.parameters = "all")
fit_causal_forest <- causal_forest(X_mm, y, z)
estimate_causal_forest <- function(y, z, X, results, true_ate){
X_mm <- model.matrix(~ . - 1, data = X)
fit_causal_forest <- causal_forest(X_mm, y, z)
# testdata_mm <- model.matrix(~ . - 1, data = testdata)
icate_predictions <- fit_causal_forest$predictions
estimates <- average_treatment_effect(fit_causal_forest)
ate_estimate <- estimates[1] # TODO benennen!
se <- estimates[2]
results <- get_metrics_not_bart(results, "causal_forest", icate_predictions, ate_estimate, se, true_ate)
}
View(causal_forest)
View(create_results_table)
View(causal_forest)
p_load(grf) # Causal Forests
fit_causal_forest <- grf::causal_forest(X_mm, y, z)
fit_causal_forest <- grf::causal_forest(X_mm, y, z, tune.parameters = "all")
estimate_causal_forest <- function(y, z, X, results, true_ate){
X_mm <- model.matrix(~ . - 1, data = X)
fit_causal_forest <- grf::causal_forest(X_mm, y, z, tune.parameters = "all")
# testdata_mm <- model.matrix(~ . - 1, data = testdata)
icate_predictions <- fit_causal_forest$predictions
estimates <- average_treatment_effect(fit_causal_forest)
ate_estimate <- estimates[1] # TODO benennen!
se <- estimates[2]
results <- get_metrics_not_bart(results, "causal_forest", icate_predictions, ate_estimate, se, true_ate)
}
for(i in 1:1){
dgp_index <- cont_dgpis$DGPid[i]
true_ate <- cont_dgpis$trueATE[i]
results <- make_results_list()
datasets_dgp <- all_datasets %>% filter(DGPid == dgp_index)
#for (j in 1:nrow(datasets_dgp)){
for (j in 1:5){
file_name <- datasets_dgp[j, "filename"]
data <- read.csv(paste0("W:/Masterarbeit/Daten/", file_name, ".csv"))
y <- data$Y
z <- data$A
X <- data %>% select(starts_with("V"))
# Regression formulas
formula_rightside <- colnames(X) %>% paste0(collapse = " + ")
ps_formula <- as.formula(paste0("z ~ ", formula_rightside))
outcome_formula <- as.formula(paste0("y ~ z + ", formula_rightside))
#PS Score calculation (needed for weighting, bcf, MAYBE psBART, MAYBE Matching?)
fit_ps_scores <- glm(ps_formula, data = data, family = binomial)
ps_scores_prediction <- predict(fit_ps_scores, type = "response")
results <- estimate_causal_forest(y, z, X, results, true_ate)
}
all_results[[paste0("dgp", dgp_index)]] <- results
all_summaries[[paste0("dgp", dgp_index)]] <- create_results_table(results)
}
View(results)
get_metrics_not_bart <- function(results_list, model_name, icate_estimates, ate_estimate, se_ate, ate_true){
# PEHE
# pehe <- sqrt(mean((icate_estimates - )^2))
# Bias
ate_bias <- ate_true - ate_estimate
# Confidence intervals
ci_lower <- ate_estimate - 1.96 * se_ate
ci_upper <- ate_estimate + 1.96 * se_ate
# CI length
ci_length <- ci_upper - ci_lower
# Coverage
is_covered <- ifelse(ci_lower <= ate_true && ate_true <= ci_upper, 1, 0)
# Save results
results_list$ate_estimate[[model_name]] <- c(results_list$ate_estimate[[model_name]], ate_estimate)
results_list$ate_bias[[model_name]] <- c(results_list$ate_bias[[model_name]], ate_bias)
results_list$ci_length[[model_name]] <- c(results_list$ci_length[[model_name]], ci_length)
results_list$coverage[[model_name]] <- c(results_list$coverage[[model_name]], is_covered)
return(results_list)
}
get_metrics_not_bart <- function(results_list, model_name, icate_estimates, ate_estimate, se_ate, ate_true){
# PEHE
# pehe <- sqrt(mean((icate_estimates - )^2))
# Bias
ate_bias <- ate_estimate- true_ate
# Confidence intervals
ci_lower <- ate_estimate - 1.96 * se_ate
ci_upper <- ate_estimate + 1.96 * se_ate
# CI length
ci_length <- ci_upper - ci_lower
# Coverage
is_covered <- ifelse(ci_lower <= ate_true & ate_true <= ci_upper, 1, 0)
# Save results
results_list$ate_estimate[[model_name]] <- c(results_list$ate_estimate[[model_name]], ate_estimate)
results_list$ate_bias[[model_name]] <- c(results_list$ate_bias[[model_name]], ate_bias)
results_list$ci_length[[model_name]] <- c(results_list$ci_length[[model_name]], ci_length)
results_list$coverage[[model_name]] <- c(results_list$coverage[[model_name]], is_covered)
return(results_list)
}
icate_predictions <- fit_causal_forest$predictions
estimates <- average_treatment_effect(fit_causal_forest)
ate_estimate <- estimates[1] # TODO benennen!
ate_estimate <- estimates[1] %>% unname() # TODO benennen!
se <- estimates[2] %>% unname()
get_metrics_not_bart <- function(results_list, model_name, icate_estimates, ate_estimate, se_ate, ate_true){
# PEHE
# pehe <- sqrt(mean((icate_estimates - )^2))
# Bias
ate_bias <- ate_estimate- true_ate
# Confidence intervals
ci_lower <- ate_estimate - 1.96 * se_ate
ci_upper <- ate_estimate + 1.96 * se_ate
# CI length
ci_length <- ci_upper - ci_lower
# Coverage
is_covered <- ifelse(ci_lower <= ate_true & ate_true <= ci_upper, 1, 0)
# Save results
results_list$ate_estimate[[model_name]] <- c(results_list$ate_estimate[[model_name]], ate_estimate)
results_list$ate_bias[[model_name]] <- c(results_list$ate_bias[[model_name]], ate_bias)
results_list$ci_length[[model_name]] <- c(results_list$ci_length[[model_name]], ci_length)
results_list$coverage[[model_name]] <- c(results_list$coverage[[model_name]], is_covered)
return(results_list)
}
results <- get_metrics_not_bart(results, "causal_forest", icate_predictions, ate_estimate, se, true_ate)
View(results)
create_results_table(results)
estimate_causal_forest <- function(y, z, X, results, true_ate){
X_mm <- model.matrix(~ . - 1, data = X)
fit_causal_forest <- grf::causal_forest(X_mm, y, z, tune.parameters = "all")
# testdata_mm <- model.matrix(~ . - 1, data = testdata)
icate_predictions <- fit_causal_forest$predictions
estimates <- average_treatment_effect(fit_causal_forest)
ate_estimate <- estimates[1] %>% unname() # TODO benennen!
se <- estimates[2] %>% unname()
results <- get_metrics_not_bart(results, "causal_forest", icate_predictions, ate_estimate, se, true_ate)
}
get_metrics_not_bart <- function(results_list, model_name, icate_estimates, ate_estimate, se_ate, ate_true){
# PEHE
# pehe <- sqrt(mean((icate_estimates - )^2))
# Bias
ate_bias <- ate_estimate- true_ate
# Confidence intervals
ci_lower <- ate_estimate - 1.96 * se_ate
ci_upper <- ate_estimate + 1.96 * se_ate
# CI length
ci_length <- ci_upper - ci_lower
# Coverage
is_covered <- ifelse(ci_lower <= ate_true & ate_true <= ci_upper, 1, 0)
# Save results
results_list$ate_estimate[[model_name]] <- c(results_list$ate_estimate[[model_name]], ate_estimate)
results_list$ate_bias[[model_name]] <- c(results_list$ate_bias[[model_name]], ate_bias)
results_list$ci_length[[model_name]] <- c(results_list$ci_length[[model_name]], ci_length)
results_list$coverage[[model_name]] <- c(results_list$coverage[[model_name]], is_covered)
return(results_list)
}
all_results <- list()
all_summaries <- list()
for(i in 1:1){
dgp_index <- cont_dgpis$DGPid[i]
true_ate <- cont_dgpis$trueATE[i]
results <- make_results_list()
datasets_dgp <- all_datasets %>% filter(DGPid == dgp_index)
#for (j in 1:nrow(datasets_dgp)){
for (j in 1:5){
file_name <- datasets_dgp[j, "filename"]
data <- read.csv(paste0("W:/Masterarbeit/Daten/", file_name, ".csv"))
y <- data$Y
z <- data$A
X <- data %>% select(starts_with("V"))
# Regression formulas
formula_rightside <- colnames(X) %>% paste0(collapse = " + ")
ps_formula <- as.formula(paste0("z ~ ", formula_rightside))
outcome_formula <- as.formula(paste0("y ~ z + ", formula_rightside))
#PS Score calculation (needed for weighting, bcf, MAYBE psBART, MAYBE Matching?)
fit_ps_scores <- glm(ps_formula, data = data, family = binomial)
ps_scores_prediction <- predict(fit_ps_scores, type = "response")
results <- estimate_causal_forest(y, z, X, results, true_ate)
print(paste("DGP: ", 1, ", Iteration: ", j))
}
all_results[[paste0("dgp", dgp_index)]] <- results
all_summaries[[paste0("dgp", dgp_index)]] <- create_results_table(results)
}
View(results)
all_results <- list()
all_summaries <- list()
for(i in 1:8){
dgp_index <- cont_dgpis$DGPid[i]
true_ate <- cont_dgpis$trueATE[i]
results <- make_results_list()
datasets_dgp <- all_datasets %>% filter(DGPid == dgp_index)
for (j in 1:nrow(datasets_dgp)){
#for (j in 1:5){
file_name <- datasets_dgp[j, "filename"]
data <- read.csv(paste0("W:/Masterarbeit/Daten/", file_name, ".csv"))
y <- data$Y
z <- data$A
X <- data %>% select(starts_with("V"))
# Regression formulas
formula_rightside <- colnames(X) %>% paste0(collapse = " + ")
ps_formula <- as.formula(paste0("z ~ ", formula_rightside))
outcome_formula <- as.formula(paste0("y ~ z + ", formula_rightside))
#PS Score calculation (needed for weighting, bcf, MAYBE psBART, MAYBE Matching?)
fit_ps_scores <- glm(ps_formula, data = data, family = binomial)
ps_scores_prediction <- predict(fit_ps_scores, type = "response")
results <- estimate_causal_forest(y, z, X, results, true_ate)
print(paste("DGP: ", 1, ", Iteration: ", j))
}
all_results[[paste0("dgp", dgp_index)]] <- results
all_summaries[[paste0("dgp", dgp_index)]] <- create_results_table(results)
}
saveRDS(paste0(PATH_RESULTS, "2026-02-25_29_CF.RData"))
saveRDS(all_results, paste0(PATH_RESULTS, "2026-02-25_29_CF.RData"))
View(all_results)
saveRDS(all_summaries, paste0(PATH_RESULTS, "2026-02-25_29_CF_summary.RData"))
i <- 2
dgp_index <- cont_dgpis$DGPid[i]
true_ate <- cont_dgpis$trueATE[i]
results <- make_results_list()
datasets_dgp <- all_datasets %>% filter(DGPid == dgp_index)
for (j in 1:nrow(datasets_dgp)){
#for (j in 1:5){
file_name <- datasets_dgp[j, "filename"]
data <- read.csv(paste0("W:/Masterarbeit/Daten/", file_name, ".csv"))
y <- data$Y
z <- data$A
X <- data %>% select(starts_with("V"))
# Regression formulas
formula_rightside <- colnames(X) %>% paste0(collapse = " + ")
ps_formula <- as.formula(paste0("z ~ ", formula_rightside))
outcome_formula <- as.formula(paste0("y ~ z + ", formula_rightside))
#PS Score calculation (needed for weighting, bcf, MAYBE psBART, MAYBE Matching?)
fit_ps_scores <- glm(ps_formula, data = data, family = binomial)
ps_scores_prediction <- predict(fit_ps_scores, type = "response")
results <- estimate_causal_forest(y, z, X, results, true_ate)
print(paste("DGP: ", 1, ", Iteration: ", j))
}
estimate_causal_forest <- function(y, z, X, results, true_ate){
X_mm <- model.matrix(~ . - 1, data = X)
fit_causal_forest <- grf::causal_forest(X_mm, y, z)
# testdata_mm <- model.matrix(~ . - 1, data = testdata)
icate_predictions <- fit_causal_forest$predictions
estimates <- average_treatment_effect(fit_causal_forest)
ate_estimate <- estimates[1] %>% unname() # TODO benennen!
se <- estimates[2] %>% unname()
results <- get_metrics_not_bart(results, "causal_forest", icate_predictions, ate_estimate, se, true_ate)
}
dgp_index <- cont_dgpis$DGPid[i]
true_ate <- cont_dgpis$trueATE[i]
results <- make_results_list()
datasets_dgp <- all_datasets %>% filter(DGPid == dgp_index)
for (j in 1:nrow(datasets_dgp)){
#for (j in 1:5){
file_name <- datasets_dgp[j, "filename"]
data <- read.csv(paste0("W:/Masterarbeit/Daten/", file_name, ".csv"))
y <- data$Y
z <- data$A
X <- data %>% select(starts_with("V"))
# Regression formulas
formula_rightside <- colnames(X) %>% paste0(collapse = " + ")
ps_formula <- as.formula(paste0("z ~ ", formula_rightside))
outcome_formula <- as.formula(paste0("y ~ z + ", formula_rightside))
#PS Score calculation (needed for weighting, bcf, MAYBE psBART, MAYBE Matching?)
fit_ps_scores <- glm(ps_formula, data = data, family = binomial)
ps_scores_prediction <- predict(fit_ps_scores, type = "response")
results <- estimate_causal_forest(y, z, X, results, true_ate)
print(paste("DGP: ", 1, ", Iteration: ", j))
}
all_results[[paste0("dgp", dgp_index)]] <- results
all_summaries[[paste0("dgp", dgp_index)]] <- create_results_table(results)
#for(i in 1:length(cont_dgpis)){
for(i in 1:){
View(all_results)
saveRDS(all_results, paste0(PATH_RESULTS, "2026-02-25_29-30_CF.RData"))
saveRDS(all_summaries, paste0(PATH_RESULTS, "2026-02-25_29-30_CF_summary.RData"))
for(i in 3:4){
dgp_index <- cont_dgpis$DGPid[i]
true_ate <- cont_dgpis$trueATE[i]
results <- make_results_list()
datasets_dgp <- all_datasets %>% filter(DGPid == dgp_index)
for (j in 1:nrow(datasets_dgp)){
#for (j in 1:5){
file_name <- datasets_dgp[j, "filename"]
data <- read.csv(paste0("W:/Masterarbeit/Daten/", file_name, ".csv"))
y <- data$Y
z <- data$A
X <- data %>% select(starts_with("V"))
# Regression formulas
formula_rightside <- colnames(X) %>% paste0(collapse = " + ")
ps_formula <- as.formula(paste0("z ~ ", formula_rightside))
outcome_formula <- as.formula(paste0("y ~ z + ", formula_rightside))
#PS Score calculation (needed for weighting, bcf, MAYBE psBART, MAYBE Matching?)
fit_ps_scores <- glm(ps_formula, data = data, family = binomial)
ps_scores_prediction <- predict(fit_ps_scores, type = "response")
results <- estimate_causal_forest(y, z, X, results, true_ate)
print(paste("DGP: ", 1, ", Iteration: ", j))
}
all_results[[paste0("dgp", dgp_index)]] <- results
all_summaries[[paste0("dgp", dgp_index)]] <- create_results_table(results)
}
saveRDS(all_results, paste0(PATH_RESULTS, "2026-02-25_29-32_CF.RData"))
saveRDS(all_summaries, paste0(PATH_RESULTS, "2026-02-25_29-32_CF_summary.RData"))
for(i in 5:6){
dgp_index <- cont_dgpis$DGPid[i]
true_ate <- cont_dgpis$trueATE[i]
results <- make_results_list()
datasets_dgp <- all_datasets %>% filter(DGPid == dgp_index)
for (j in 1:nrow(datasets_dgp)){
#for (j in 1:5){
file_name <- datasets_dgp[j, "filename"]
data <- read.csv(paste0("W:/Masterarbeit/Daten/", file_name, ".csv"))
y <- data$Y
z <- data$A
X <- data %>% select(starts_with("V"))
# Regression formulas
formula_rightside <- colnames(X) %>% paste0(collapse = " + ")
ps_formula <- as.formula(paste0("z ~ ", formula_rightside))
outcome_formula <- as.formula(paste0("y ~ z + ", formula_rightside))
#PS Score calculation (needed for weighting, bcf, MAYBE psBART, MAYBE Matching?)
fit_ps_scores <- glm(ps_formula, data = data, family = binomial)
ps_scores_prediction <- predict(fit_ps_scores, type = "response")
results <- estimate_causal_forest(y, z, X, results, true_ate)
print(paste("DGP: ", 1, ", Iteration: ", j))
}
all_results[[paste0("dgp", dgp_index)]] <- results
all_summaries[[paste0("dgp", dgp_index)]] <- create_results_table(results)
}
saveRDS(all_results, paste0(PATH_RESULTS, "2026-02-25_29-38_CF.RData"))
saveRDS(all_summaries, paste0(PATH_RESULTS, "2026-02-25_29-38_CF_summary.RData"))
for(i in 7:8){
dgp_index <- cont_dgpis$DGPid[i]
true_ate <- cont_dgpis$trueATE[i]
results <- make_results_list()
datasets_dgp <- all_datasets %>% filter(DGPid == dgp_index)
for (j in 1:nrow(datasets_dgp)){
#for (j in 1:5){
file_name <- datasets_dgp[j, "filename"]
data <- read.csv(paste0("W:/Masterarbeit/Daten/", file_name, ".csv"))
y <- data$Y
z <- data$A
X <- data %>% select(starts_with("V"))
# Regression formulas
formula_rightside <- colnames(X) %>% paste0(collapse = " + ")
ps_formula <- as.formula(paste0("z ~ ", formula_rightside))
outcome_formula <- as.formula(paste0("y ~ z + ", formula_rightside))
#PS Score calculation (needed for weighting, bcf, MAYBE psBART, MAYBE Matching?)
fit_ps_scores <- glm(ps_formula, data = data, family = binomial)
ps_scores_prediction <- predict(fit_ps_scores, type = "response")
results <- estimate_causal_forest(y, z, X, results, true_ate)
print(paste("DGP: ", 1, ", Iteration: ", j))
}
all_results[[paste0("dgp", dgp_index)]] <- results
all_summaries[[paste0("dgp", dgp_index)]] <- create_results_table(results)
}
View(all_results)
View(all_summaries)
saveRDS(all_results, paste0(PATH_RESULTS, "2026-02-25_29-40_CF.RData"))
saveRDS(all_summaries, paste0(PATH_RESULTS, "2026-02-25_29-40_CF_summary.RData"))
for(i in 9:10){
dgp_index <- cont_dgpis$DGPid[i]
true_ate <- cont_dgpis$trueATE[i]
results <- make_results_list()
datasets_dgp <- all_datasets %>% filter(DGPid == dgp_index)
for (j in 1:nrow(datasets_dgp)){
#for (j in 1:5){
file_name <- datasets_dgp[j, "filename"]
data <- read.csv(paste0("W:/Masterarbeit/Daten/", file_name, ".csv"))
y <- data$Y
z <- data$A
X <- data %>% select(starts_with("V"))
# Regression formulas
formula_rightside <- colnames(X) %>% paste0(collapse = " + ")
ps_formula <- as.formula(paste0("z ~ ", formula_rightside))
outcome_formula <- as.formula(paste0("y ~ z + ", formula_rightside))
#PS Score calculation (needed for weighting, bcf, MAYBE psBART, MAYBE Matching?)
fit_ps_scores <- glm(ps_formula, data = data, family = binomial)
ps_scores_prediction <- predict(fit_ps_scores, type = "response")
results <- estimate_causal_forest(y, z, X, results, true_ate)
print(paste("DGP: ", 1, ", Iteration: ", j))
}
all_results[[paste0("dgp", dgp_index)]] <- results
all_summaries[[paste0("dgp", dgp_index)]] <- create_results_table(results)
}
saveRDS(all_results, paste0(PATH_RESULTS, "2026-02-25_29-58_CF.RData"))
saveRDS(all_summaries, paste0(PATH_RESULTS, "2026-02-25_29-58_CF_summary.RData"))
for(i in 11:13){
dgp_index <- cont_dgpis$DGPid[i]
true_ate <- cont_dgpis$trueATE[i]
results <- make_results_list()
datasets_dgp <- all_datasets %>% filter(DGPid == dgp_index)
for (j in 1:nrow(datasets_dgp)){
#for (j in 1:5){
file_name <- datasets_dgp[j, "filename"]
data <- read.csv(paste0("W:/Masterarbeit/Daten/", file_name, ".csv"))
y <- data$Y
z <- data$A
X <- data %>% select(starts_with("V"))
# Regression formulas
formula_rightside <- colnames(X) %>% paste0(collapse = " + ")
ps_formula <- as.formula(paste0("z ~ ", formula_rightside))
outcome_formula <- as.formula(paste0("y ~ z + ", formula_rightside))
#PS Score calculation (needed for weighting, bcf, MAYBE psBART, MAYBE Matching?)
fit_ps_scores <- glm(ps_formula, data = data, family = binomial)
ps_scores_prediction <- predict(fit_ps_scores, type = "response")
results <- estimate_causal_forest(y, z, X, results, true_ate)
print(paste("DGP: ", 1, ", Iteration: ", j))
}
all_results[[paste0("dgp", dgp_index)]] <- results
all_summaries[[paste0("dgp", dgp_index)]] <- create_results_table(results)
}
saveRDS(all_results, paste0(PATH_RESULTS, "2026-02-25_29-61_CF.RData"))
saveRDS(all_summaries, paste0(PATH_RESULTS, "2026-02-25_29-61_CF_summary.RData"))
for(i in 14:16){
dgp_index <- cont_dgpis$DGPid[i]
true_ate <- cont_dgpis$trueATE[i]
results <- make_results_list()
datasets_dgp <- all_datasets %>% filter(DGPid == dgp_index)
for (j in 1:nrow(datasets_dgp)){
#for (j in 1:5){
file_name <- datasets_dgp[j, "filename"]
data <- read.csv(paste0("W:/Masterarbeit/Daten/", file_name, ".csv"))
y <- data$Y
z <- data$A
X <- data %>% select(starts_with("V"))
# Regression formulas
formula_rightside <- colnames(X) %>% paste0(collapse = " + ")
ps_formula <- as.formula(paste0("z ~ ", formula_rightside))
outcome_formula <- as.formula(paste0("y ~ z + ", formula_rightside))
#PS Score calculation (needed for weighting, bcf, MAYBE psBART, MAYBE Matching?)
fit_ps_scores <- glm(ps_formula, data = data, family = binomial)
ps_scores_prediction <- predict(fit_ps_scores, type = "response")
results <- estimate_causal_forest(y, z, X, results, true_ate)
print(paste("DGP: ", 1, ", Iteration: ", j))
}
all_results[[paste0("dgp", dgp_index)]] <- results
all_summaries[[paste0("dgp", dgp_index)]] <- create_results_table(results)
}
saveRDS(all_results, paste0(PATH_RESULTS, "2026-02-25_29-64_CF.RData"))
saveRDS(all_summaries, paste0(PATH_RESULTS, "2026-02-25_29-64_CF_summary.RData"))
